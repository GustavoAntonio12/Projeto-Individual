<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="https://kit.fontawesome.com/2eecc47c4e.js" crossorigin="anonymous"></script>
    <link rel="icon" type="image/x-icon" href="assets/img/start.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/validacoes.js"></script>
    <script src="assets/js/funcoes.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Koulen&family=Poppins:wght@100&family=Roboto+Flex:opsz@8..144&display=swap"
        rel="stylesheet">
    <title>Home</title>
</head>

<body onload="validarSessao(); listarPostagensUsuario(id)">
    <header>
        <nav>
            <div class="logo">
                <h4>Steven Universe</h4>
            </div>
            <ul class="nav-links" id="menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="sobre.html">Sobre</a></li>
                <li><a href="quiz.html">Quiz</a></li>
                <li><a href="postagens.html">Postagens</a></li>
                <li><a href="usuario.html" class="ativo">Minha √Årea</a></li>
            </ul>
            <div class="burger">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
        </nav>
    </header>

    <main>
        <div class="section5">
            <div class="conteudo">

                <div>
                    <h3>Nome: <span id="nome"></span> </h3>
                    <h3>Email: <span id="email"></span> </h3>
                    <h3>Telefone: <span id="telefone"></span> </h3>
                </div>
                <a href="atualizar.html"><button class="button">Atualizar</button></a>
            </div>
            <div class="lista">
                <div class="indicadores">
                    <i class="fa-solid fa-file-lines fa-my fa-xl"></i>
                    <h3>Quantidade De Post's</h3>
                    </h3>
                    <span id="posts"></span>
                </div>
                <div class="indicadores">
                    <i class="fa-solid fa-star fa-my fa-xl"></i>
                    <h3> Post's Com Estrelas</h3>
                    </h3>
                    <span id="estrelas"></span>
                </div>
                <div class="indicadores">
                    <i class="fa-solid fa-bookmark fa-my fa-xl"></i>
                    <h3>Testes Realizados</h3>
                    <span id="teste"></span>
                </div>
            </div>

            <div class="lista2">
                <div class="chart-container tamanho">
                    <canvas id="myChart1"></canvas>
                </div>
                <div class="chart-container tamanho">
                    <canvas id="myChart2"></canvas>
                </div>
                
                  
            </div>
            <div class="post2" id="post">
                <h2>Seus Post's</h2>
            </div>
            <div class="sair">
                <a onclick="limparSessao();"><button class="button">Sair</button></a>
            </div>
        </div>


    </main>
    <footer>
        <ul class="footer">
            <li><a>Home</a></li>
            <li><a>Quiz</a></li>
            <li><a>Login</a></li>
            <li><a>Usuario</a></li>
            <li><a>Sobre</a></li>
        </ul>

    </footer>
    <script src="assets/js/main.js"></script>
</body>
<script>
    var session = obterDadosSession();
    id = session.idUsuario;
    nome.innerHTML = session.nomeUsuario;
    email.innerHTML = session.emailUsuario;
    telefone.innerHTML = session.telefoneUsuario
    estrelas.innerHTML = "2";
    teste.innerHTML = "3";
    posts.innerHTML = 0;


    function listarPostagensUsuario(idUsuario) {

        fetch(`/postagens/listarPostagensUsuario/${id}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (resposta) {
            console.log('Resposta: ', resposta);

            if (resposta.ok) {
                resposta.json().then(json => {
                    console.log(json);
                    postagens = json;

                    if (postagens.length > 0) {
                        posts.innerHTML = postagens.length;
                        for (let index = 0; index < postagens.length; index++) {
                            var postagem = postagens[index];
                            renderizarPostagem(postagem);
                        }
                    }
                });

            }
        });
    }
    function renderizarPostagem(json) {
        post.innerHTML += `
<div class="posts" id=${json.idPostagens}>
    <h3>${json.tituloPostagens}</h3>
    <p>${json.textoPostagens}</p>
    <small>Por: ${json.nomeUsuario}</small>
    <i class="fa-solid fa-pen fa-my " onclick="alterar(${json.idPostagens});"></i>
    <i class="fa-solid fa-trash fa-my" onclick="deletar(${json.idPostagens});"></i>
</div>`;
    }

    function deletar(id) {
        fetch(`/postagens/deletar/${id}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            },
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                Swal.fire({
                    title: 'Sucesso',
                    text: 'Post Deletado Com Sucesso',
                    icon: 'success',
                    timer: 2000,
                    timerProgressBar: true,
                    confirmButtonText: 'Fechar',
                    willClose: () => {
                        window.location = "usuario.html";
                    }
                });

            } else {
                throw ("Houve um erro ao tentar realizar o deletar!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
        return false;

    }


    function alterar() {
        alert("alterar");
    }


</script>

<script>
    const labels = [
      'January',
      'February',
      'March',
      'April',
      'May',
      'June',
    ];
  
    const data = {
      labels: labels,
      datasets: [{
        label: 'My First dataset',
        backgroundColor: 'rgb(255, 99, 132)',
        borderColor: 'rgb(255, 99, 132)',
        data: [0, 10, 5, 2, 20, 30, 45],
      }]
    };
  
    const config = {
      type: 'line',
      data: data,
      options: {}
    };
  </script>
<script>
    const myChart1 = new Chart(
      document.getElementById('myChart1'),
      config
    );
    const myChart2 = new Chart(
      document.getElementById('myChart2'),
      config
    );
  </script>
    
</html>